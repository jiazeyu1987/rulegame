# 📄 规则怪谈游戏 - 产品需求文档 (PRD)

## 1. 项目背景

### 项目简介
开发一款基于线性7天流程的规则怪谈文字冒险游戏，玩家通过选择不同行动推进剧情，在诡异规则的寝室环境中生存并达成通关条件。

### 市场/用户痛点
- 用户对传统文字冒险游戏的新鲜感需求
- 规则怪谈题材在年轻群体中的热度上升
- 需要一款具有中国特色（省份选择、地图展示）的文字冒险游戏

### 目标
打造一款具有完整7天流程、支持本地存档、具备中国地图展示功能的规则怪谈文字冒险游戏。

## 2. 产品目标

### 核心目标（必须完成）
- ✅ 实现7天（第0天-第7天）线性游戏流程
- ✅ 支持玩家输入名字和选择省份
- ✅ 本地实时存储游戏进度
- ✅ 读取并解析Python脚本（0-7天）配置的故事内容
- ✅ 识别通关条件达成和死亡条件达成
- ✅ 游戏重启后能够恢复之前的游戏进度
- ✅ 通关后展示中国地图和各省份通关人数

### 次要目标（增强体验）
- 日历式进度展示UI
- 淡入淡出界面过渡效果
- 清除记忆功能（重新开始游戏）

### 不做的目标（明确边界）
- ❌ 不涉及具体的游戏故事内容设计
- ❌ 不实现多标签页支持
- ❌ 不实现跳过和返回功能
- ❌ 不实现联网对战功能

## 3. 用户画像与使用场景

### 目标用户
- 主要人群：18-35岁喜爱文字冒险、规则怪谈题材的游戏玩家
- 典型角色：学生、上班族、文字游戏爱好者

### 使用场景
- 碎片化时间娱乐（通勤、休息间隙）
- 沉浸式剧情体验需求
- 对规则解谜类游戏的兴趣

### 用户价值
- 提供完整的7天规则怪谈体验
- 支持随时暂停和恢复游戏进度
- 具有中国特色的省份选择和地图展示

## 4. 用户流程 / 游戏流程

### 完整游戏流程

```
首次进入游戏
    ↓
检测本地存档
    ↓
有存档？——否——→ 输入玩家名字
    ↓ 是            ↓
恢复游戏进度      选择省份（中国地图）
    ↓              ↓
继续游戏 ←——— 进入第0天（新手引导）
    ↓
第1-7天（线性解锁）
    ↓
完成第7天
    ↓
展示中国地图（各省份通关人数）
    ↓
游戏结束
```

### 关键流程说明

**存档恢复流程：**
- 每次进入游戏时检测本地存档
- 有存档则直接恢复到最近的游戏节点
- 无存档则重新开始游戏流程

**进度存储流程：**
- 玩家每次做出选择后立即保存进度
- 存储内容包括：玩家名字、省份、当前天数、节点位置
- 确保游戏异常退出后能够恢复

**通关检测流程：**
- 实时监测游戏状态（通关条件/死亡条件）
- 达成条件时触发相应的游戏结束逻辑

## 5. 功能需求

### 5.1 核心功能

**存档管理功能**
- 本地存储玩家基本信息（名字、省份）
- 实时保存游戏进度（当前天数、节点）
- 支持存档恢复和清除

**Python脚本解析功能**
- 读取并解析day0_story.py到day7_story.py
- 提取故事内容、选择分支、条件逻辑
- 支持动态加载游戏配置

**游戏流程控制功能**
- 实现7天线性解锁机制
- 支持节点间的跳转和选择
- 识别并处理通关/死亡条件

**地图交互功能**
- 省份选择（首次进入游戏）
- 通关人数展示（游戏完成后）
- 渐变色地图显示

### 5.2 交互与界面

**界面布局要求**
- 简洁的文字冒险界面
- 选项按钮清晰可点击
- 进度状态明显可见

**过渡效果**
- 界面切换采用淡入淡出效果
- 确保过渡平滑自然

**交互限制**
- 无跳过选项（必须完整体验）
- 无返回选项（选择不可撤销）
- 支持直接退出（关闭程序）

### 5.3 数据存储与管理

**存储位置**
- 本地文件系统存储
- 存档文件格式：JSON

**存储结构**
```json
{
  "playerName": "玩家名字",
  "selectedProvince": "选择的省份",
  "currentDay": 当前天数,
  "currentNode": "当前节点ID",
  "gameConfigPath": "游戏配置文件路径"
}
```

**同步/恢复机制**
- 每步选择后立即写入存档
- 游戏启动时自动读取存档
- 异常退出后从最近节点恢复

### 5.4 错误与异常处理

**异常场景**
- Python脚本解析失败
- 存档文件损坏
- 游戏配置缺失

**处理机制**
- 错误日志写入本地.log文件
- 友好的错误提示信息
- 提供重新开始的选项

## 6. 技术需求

### 技术栈
- **前端**：React + TypeScript + Vite
- **脚本引擎**：Python脚本解析
- **存储**：本地文件存储
- **地图组件**：中国地图可视化组件

### 打包/部署方式
- 封装为exe可执行文件
- 单文件部署
- 不允许多标签页运行

### 外部依赖
- Python脚本引擎（解析故事配置）
- 中国地图组件（省份选择和数据展示）
- 本地文件操作API

### 日志/监控方案
- 本地.log文件记录错误日志
- 包含时间戳、错误类型、详细信息的日志格式

## 7. 非功能需求

### 性能要求
- 存档操作响应时间 < 100ms
- 界面切换无明显延迟
- 支持单用户并发

### 安全性
- 本地数据加密存储（可选）
- 防止存档文件篡改
- 保护用户隐私信息

### 兼容性
- 支持Windows操作系统
- 兼容主流Windows版本（Win7及以上）

### 稳定性
- 异常退出后数据完整性保证
- 提供数据恢复机制
- 避免程序崩溃和数据丢失

### 可扩展性
- 支持新增天数和节点
- 便于修改游戏配置
- 模块化设计便于维护

## 8. 开发优先级 / 里程碑

### P0（必须优先完成）
- ✅ Python脚本解析引擎（day0-7）
- ✅ 本地存档系统（保存/恢复）
- ✅ 游戏流程控制（7天线性流程）
- ✅ 通关/死亡条件识别
- ✅ 省份选择和地图展示

### P1（次要，重要但可以延后）
- 📅 日历式进度UI优化
- 📅 淡入淡出过渡效果
- 📅 错误日志系统

### P2（可选功能）
- 🔮 数据加密存储
- 🔮 游戏统计数据
- 🔮 界面主题切换

## 9. 依赖与风险

### 依赖项
- **Python脚本**：day0_story.py到day7_story.py配置文件
- **地图组件**：中国地图可视化库
- **打包工具**：exe封装工具

### 风险点
- **技术风险**：Python脚本解析的稳定性
- **数据风险**：本地存档的安全性和完整性
- **性能风险**：大量数据存储的性能影响

### 风险应对方案
- 建立完善的错误处理机制
- 实现数据备份和恢复功能
- 进行充分的性能测试和优化

## 10. 验收标准

### 功能验收标准

**存档功能验收：**
- Given 玩家做出选择，When 选择完成后，Then 游戏进度立即保存到本地
- Given 游戏异常退出，When 重新启动游戏时，Then 能够从最近节点恢复游戏

**Python脚本解析验收：**
- Given 存在day0-7的Python脚本，When 游戏启动时，Then 能够正确解析所有脚本内容
- Given 脚本中包含通关条件，When 玩家达成条件时，Then 正确识别并触发通关逻辑

**地图功能验收：**
- Given 首次进入游戏，When 玩家点击省份时，Then 省份高亮并记录选择
- Given 完成第7天，When 游戏结束时，Then 展示中国地图和各省份通关人数

**游戏流程验收：**
- Given 完成第0天，When 进入第1天时，Then 线性解锁机制正常工作
- Given 处于第3天，When 尝试跳转到第5天时，Then 无法跳过未解锁的天数

### 性能验收标准
- 存档操作响应时间 ≤ 100ms
- 界面切换延迟 ≤ 200ms
- 程序启动时间 ≤ 3秒

## 11. 附录

### 相关文档链接
- 需求文档：`doc/需求文档.txt`
- PRD模板：`doc/PRD模板.txt`
- 项目结构：`IFLOW.md`

### 名词解释
- **线性流程**：必须按顺序完成每一天，不能跳过
- **节点**：游戏中的关键决策点
- **通关条件**：完成游戏所需达到的条件
- **死亡条件**：导致游戏失败的条件